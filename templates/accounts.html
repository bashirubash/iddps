{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">üë§ Accounts</h2>

<!-- Account creation form -->
<div class="card mb-4 shadow-sm border-0">
  <div class="card-header bg-success text-white">Create New Account</div>
  <div class="card-body">
    <form id="createAccountForm" class="row g-3">
      <div class="col-md-4">
        <input type="text" class="form-control" name="account_number" placeholder="Account Number" required>
      </div>
      <div class="col-md-4">
        <input type="text" class="form-control" name="holder_name" placeholder="Holder Name" required>
      </div>
      <div class="col-md-3">
        <input type="number" step="0.01" class="form-control" name="balance" placeholder="Initial Balance (‚Ç¶)" required>
      </div>
      <div class="col-md-1">
        <button type="submit" class="btn btn-success w-100">Add</button>
      </div>
    </form>
  </div>
</div>

<!-- Accounts table -->
<div class="card shadow-sm border-0">
  <div class="card-header bg-primary text-white">All Accounts</div>
  <div class="card-body p-0">
    <table class="table table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>Account Number</th>
          <th>Holder Name</th>
          <th>Balance (‚Ç¶)</th>
        </tr>
      </thead>
      <tbody>
        {% for acct in accounts %}
        <tr>
          <td>{{ acct.account_number }}</td>
          <td>{{ acct.holder_name }}</td>
          <td>‚Ç¶{{ "%.2f"|format(acct.balance) }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="3" class="text-center text-muted">No accounts yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
document.getElementById("createAccountForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData.entries());

  const res = await fetch("/api/accounts", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });
  if (res.ok) {
    alert("‚úÖ Account created!");
    location.reload();
  } else {
    const err = await res.json();
    alert("‚ùå Error: " + err.error);
  }
});
</script>

{% endblock %}
