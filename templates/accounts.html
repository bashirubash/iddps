{% extends "base.html" %}
{% block content %}
<div class="container">
  <h2 class="mb-4">üí≥ Accounts</h2>

  <!-- Account Creation Form -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">Create New Account</div>
    <div class="card-body">
      <form id="createAccountForm" class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Account Number</label>
          <input type="text" class="form-control" id="account_number" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">Holder Name</label>
          <input type="text" class="form-control" id="holder_name" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">Initial Balance (‚Ç¶)</label>
          <input type="number" class="form-control" id="balance" min="0" required>
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-success">‚ûï Create Account</button>
        </div>
      </form>
      <div id="createAccountMsg" class="mt-2"></div>
    </div>
  </div>

  <!-- Accounts Table -->
  <div class="card shadow-sm">
    <div class="card-header bg-secondary text-white">All Accounts</div>
    <div class="card-body">
      <table class="table table-striped">
        <thead class="table-dark">
          <tr>
            <th>Account Number</th>
            <th>Holder Name</th>
            <th>Balance (‚Ç¶)</th>
          </tr>
        </thead>
        <tbody>
          {% for acc in accounts %}
          <tr>
            <td>{{ acc.account_number }}</td>
            <td>{{ acc.holder_name }}</td>
            <td>‚Ç¶{{ "%.2f"|format(acc.balance) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
document.getElementById("createAccountForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  
  const data = {
    account_number: document.getElementById("account_number").value,
    holder_name: document.getElementById("holder_name").value,
    balance: document.getElementById("balance").value
  };

  const res = await fetch("/api/accounts", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(data)
  });

  const msg = document.getElementById("createAccountMsg");
  if (res.ok) {
    msg.innerHTML = `<div class="alert alert-success">‚úÖ Account created successfully!</div>`;
    setTimeout(() => window.location.reload(), 1000);
  } else {
    const err = await res.json();
    msg.innerHTML = `<div class="alert alert-danger">‚ùå ${err.error}</div>`;
  }
});
</script>
{% endblock %}
